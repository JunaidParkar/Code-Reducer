# Code Reducer

![GitHub stars](https://img.shields.io/github/stars/JunaidParkar/codeReducer?style=social)
![GitHub forks](https://img.shields.io/github/forks/JunaidParkar/codeReducer?style=social)

The base module for the `codeReducer` library.

# Overview

`Code Reducer` is a versatile JavaScript library designed to simplify and enhance your web development projects. This library offers a range of features to streamline your code and create engaging user experiences.

# Key Features

- **Dkit**: With Dkit, manipulating the DOM becomes a breeze! Enjoy coding with Dkit.

- **Custom Cursors**: Create custom cursors with magnetic effects, making your web applications visually engaging and interactive.

- **Captcha Generation**: Generate captchas to verify human users and enhance security in your applications. Captchas expire within 2 minutes after generation.

- **Canvas video animation**: Create video like animation using frames on videos based on scrolling.

# Installation

You can install `codeReducer` via npm:

```bash
npm install codereducer
```

# Usage

Here's how you can use the `codeReducer` library in your JavaScript/TypeScript projects:

## Manipulate `DOM` with `Dkit`

```javascript
import Dkit from "codereducer/dkit";
```

### `API Reference`

### init()

This method initialize Dkit tools.

```javascript
let dkit = Dkit.init();
```

### id()

This method can be used to select an element with the specified ID.

```javascript
dkit.id("myId");
```

### class()

This method can be used to select an element with the specified class name.

```javascript
dkit.class("myClass");
```

### tag()

This method can be used to select an element with the specified tag name.

```javascript
dkit.tag("myTag");
```

### query()

This method can be used to select an element using a CSS selector.

```javascript
dkit.query(".myClass #myId");
```

### create()

This method can be used to select a new HTML element with the specified tag.

```javascript
dkit.create("div");
```

### get()

This method is mandatory as it returns the currently selected HTML element.

```javascript
let element = dkit.get();
```

### revert()

This method can be used for cleanUp. It clears all the selected elements

### `How to use in frameworks`

Here's an example of how you might use Dkit to create a new `div` element, add it to the DOM, and then manipulate it:

```javascript
import Dkit from "codereducer/dkit";

// Create a new div element
let div = Dkit.init().create("div").get();

// Add the div to the body of the document
document.body.appendChild(div);
```

Now get an list of all `h3` tag from inside a `div` tag with id myDiv

```javascript
import Dkit from "codereducer/dkit";

// target all h3 in div
let h3 = Dkit.init().id("myDiv").tag("h3").get();
```

use single call for multiple manipulations

```javascript
import Dkit from "codereducer/dkit";

// initialize dKit
let kit = Dkit.init();

// get first element
let elem = init.id("scroll1").tag("canvas").get();

// target second element
let h1 = init.id("try").tag("h1");

// get second element
let elem2 = h1.get();

// use all elements
console.log(elem1); // return all the element you targetted
console.log(elem2); // return all the element you targetted
console.log(h1); // consoles the array or a prototype

h1.revert(); // cleans up all the instances

console.log(h1); // console or return null
```

With Dkit, manipulating the DOM becomes a breeze! Enjoy coding with Dkit.

## Create `Custom Cursor`

1. To create a custom cursor in all the routes, Create a component file. Lets assume it as cursor.jsx

```javascript
'use client'
import customCursor from 'codereducer/cursor'
import React, { useEffect, useRef } from 'react'

const Cursor = () => {
let crsr = useRef(null)  
useEffect(() => {
  let c = new customCursor(crsr.current, false) // change the second parameter to true if you want to customize the stylesheet of your custom cursor.
  c.getCursor()
  return () => {
    c.revert()
  }
}, [])

return (
    <div ref={crsr}></div>
  )
}

export default Cursor
```

  2. Now in your main entry file of your framework perform this code. In this case it is Next JS is used

```javascript
import Cursor from '@/components/cursor'
import './globals.css'
import { Inter } from 'next/font/google'

const inter = Inter({ subsets: ['latin'] })

export const metadata = {
  title: 'Create Next App',
  description: 'Generated by create next app',
}

export default function RootLayout({ children }) {
  return (
    <html lang="en">
      <body className={inter.className}>
        {<Cursor />}
        {children}
      </body>
    </html>
  )
}
```

### Create a magnetic effect after adding custom cursor.
`Note: Custom cursor is mandatory in order to make magnetic effect`

```javascript
'use client'
import customCursor from 'codereducer/cursor'
import { useEffect, useRef } from 'react'

export default function Home() {

  const myRef = useRef();

  const setRef = (element) => {
    if (element) {
      myRef.current = [...(myRef.current || []), element];
    }
  };

  useEffect(() => {
    let c = new customCursor()
    c.makeMagnet(myRef.current)
    return () => {
      c.revert()
    }
  }, []);
  
  return (
    <div ref={setRef}></div>
    <h1 ref={setRef}></h1>
    <a ref={setRef}></a>
  )
```

## Generate and verify `captcha`

### In `React/Next JS`

```javascript
import { useState, useRef, useEffect } from 'react'
import reactLogo from './assets/react.svg'
import viteLogo from '/vite.svg'
import captcha from "codereducer/captcha";
import './App.css'

function App() {
  const [userInput, setUserInput] = useState('');
  const [tk, setTk] = useState(null);
  const reference = useRef(null);

  const generateCaptcha = () => {
    return new Promise((resolve, reject) => {
      let capt = new captcha(reference.current, '#f5f5f5', '6rRwhBidAD0dME9mSo8Rr88F9A8TLVcR');
      capt.createCaptha((token, status) => {
        if (status) {
          console.log(token);
          setTk(token);
          resolve(token);
        } else {
          reject('Error generating captcha');
        }
      });
    });
  };

  const verifyCaptcha = async () => {
      await generateCaptcha(); // Wait for the token to be generated
      let cr = new captcha(reference.current, '#f5f5f5', '6rRwhBidAD0dME9mSo8Rr88F9A8TLVcR');
      cr.verifyCaptcha(userInput, tk, (status, message) => {
        if (status) {
          // Captcha verified successfully
          console.log('verified');
        } else {
          console.log('failed');
          // Captcha verification not successful
        }
      });
  };

  const updater = (e) => {
    setUserInput(e.target.value);
  };

  const submit = () => {
    verifyCaptcha();
  };

  useEffect(() => {
    generateCaptcha();
  }, []);

  return (
    <>
      <div>
        <a href="https://vitejs.dev" target="_blank">
          <img src={viteLogo} className="logo" alt="Vite logo" />
        </a>
        <a href="https://react.dev" target="_blank">
          <img src={reactLogo} className="logo react" alt="React logo" />
        </a>
      </div>
      <input type="text" onChange={(e) => {updater(e)}} />
      <button onClick={() => submit()}>click</button>
      <div className="card">
        <canvas ref={reference}></canvas>
        <p>
          Edit <code>src/App.jsx</code> and save to test HMR
        </p>
      </div>
      <p className="read-the-docs">
        Click on the Vite and React logos to learn more
      </p>
    </>
  )
}

export default App
```

### In `Vue JS`

```javascript
<template>
  <div>
    <canvas ref="captchaCanvas"></canvas>
  </div>
</template>

<script>
import captcha from "codereducer/captcha";
export default {
  data() {
    return {
      captchaInstance: null,
      userInput: "",
      token: null,
    };
  },
  mounted() {
    this.captchaInstance = new captcha(this.$refs.captchaCanvas, "#28282B");
  },
  methods: {
    createCaptcha() {
      this.captchaInstance.createCaptha((token, success) => {
        if (success) {
          // store the token somewhere
        } else {
          // error while creating captcha
        }
      });
    },
    verifyCaptcha() {
      this.captchaInstance.verifyCaptcha(
        this.userInput,
        this.token,
        (success, message) => {
          if (success) {
            // captcha verification successful
          } else {
            // failed in captcha verification
          }
        }
      );
    },
  },
  beforeDestroy() {
    this.captchaInstance.revert();
    this.captchaInstance = null;
  },
};
</script>
```

## Generate an Array of Images for Animation in Canvas Parallax

1. **Extract Frames from Video:**

   - Visit [Aspose Video to Image](https://products.aspose.app/video/video-to-image) and extract frames from your video. Choose a high frame count option based on your preference.

2. **Download and Extract Frames:**

   - Download the frames as a zip file and extract the contents.

3. **Setup Node.js Project:**

   - Create a new Node.js project or use an existing one.

4. **Install Code Reducer:**

   - Install `Code Reducer` using the following command:
     ```bash
     npm install codereducer
     ```

5. **Node.js Script to Generate Image Array:**

   - Create a new file in your project and add the following Node.js script:

     ```javascript
     const { handleImage } = require("codereducer/handleImages");

     new handleImage.createImageList(pathToFrames, outputPath);
     ```

     Replace `pathToFrames` with the full path to the directory containing your extracted frames and `outputPath` with the desired output directory for the array of image names.

6. **Run the Node.js Script:**

   - Run the Node.js script to generate a file named `listImages101.js` containing an array with image names in series.

7. **Organize Images in Your Project:**

   - Copy all the extracted images to your project's public directory. Create a folder (e.g., "xyz") and place the images inside this folder.

8. **Start Your Project Server:**

   - Start your project server.

9. **Access Images in Your Browser:**

   - Navigate to `http://yourprojecturl/xyz/imageName.jpg` to confirm that the images render correctly.

10. **Create an `images.js` File:**

    - In your project's `components` folder, create a file named `images.js`.

11. **Update `images.js` with Image Array:**

    - Update `images.js` with the image array obtained in step 6, adding the prefix `/xyz/` to each image path.

12. **Example `images.js`:**

    ```javascript
    export default [
      "/xyz/image1.jpg",
      "/xyz/image2.jpg",
      ...
    ];
    ```

13. **Implementation Ready:**
    - Your project is now set up and ready to use for creating a parallax animation using the generated image array.

## Animate `canvas parallex`

#### Use [aspose](https://products.aspose.app/video/video-to-image) for getting frames out of video.

#### Before starting this follow all the steps described above for getting array of all the images with assigning proper paths.

### In `React\Next JS`

```javascript
"use client";

import React, { useEffect, useLayoutEffect, useRef } from "react";
import { Josefin_Sans } from "next/font/google";
import images from "@/components/images"; // This images is an array containing absolute path of all images with respect to base URL
import canvasLoader from "codereducer/canvas";

const Home = () => {
  const cv = useRef(null);

  useLayoutEffect(() => {
    let canvas = new canvasLoader(cv.current, images, 200); // 200 is percentage of page till where animation should work change as per your convenience
    canvas.init();
    return () => {
      canvas.revert();
    };
  }, [cv]);

  return (
    <>
      <canvas ref={cv}></canvas>
    </>
  );
};

export default Home;
```

### In `Vue JS`

```javascript
<template>
  <div style={{height: ypx, width: xpx}}> // Important to give width and height to parent of canvas
    <canvas ref="canvas"></canvas>
  </div>
</template>

<script>
import CanvasLoader from './canvasLoader';

export default {
  data() {
    return {
      loader: null,
    };
  },
  mounted() {
    const canvasElement = this.$refs.canvas;
    const frames = [...]; // your frames extracted from video
    const percentToScroll = 300; // your percentToScroll change as per your convenience
    this.loader = new CanvasLoader(canvasElement, frames, percentToScroll);
    this.loader.init();
  },
  beforeDestroy() {
    if (this.loader) {
      this.loader.revert();
    }
  },
};
</script>
```
